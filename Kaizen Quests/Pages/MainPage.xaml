<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Kaizen_Quests.Pages.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:Kaizen_Quests.ViewModels"
    Shell.NavBarIsVisible="False">

    <ContentPage.BindingContext>
        <viewModels:MainViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="*,Auto">
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="24">

                <!--  Quest-Liste  -->
                <CollectionView ItemsSource="{Binding Quests}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame
                                Margin="0,0,0,12"
                                Padding="12"
                                BackgroundColor="{Binding Color}"
                                BorderColor="#88888888"
                                HasShadow="True"
                                CornerRadius="24">

                                <VerticalStackLayout>

                                    <!--  Quest-Header mit Grid  -->
                                    <Grid
                                        Padding="0"
                                        ColumnDefinitions="*, Auto"
                                        VerticalOptions="Center">

                                        <Entry
                                            Grid.Column="0"
                                            BackgroundColor="Transparent"
                                            FontAttributes="Bold"
                                            FontSize="16"
                                            Placeholder="Quest-Titel"
                                            Text="{Binding Title}" />

                                        <Label
                                            Grid.Column="1"
                                            Padding="8,0,0,0"
                                            FontSize="24"
                                            HorizontalOptions="End"
                                            Text="↕"
                                            VerticalOptions="Center">
                                            <Label.GestureRecognizers>
                                                <DragGestureRecognizer DragStartingCommand="{Binding BindingContext.StartQuestDragCommand, Source={x:Reference MainPageRef}}" DragStartingCommandParameter="{Binding}" />
                                            </Label.GestureRecognizers>
                                        </Label>

                                    </Grid>

                                    <!--  Goals CollectionView  -->
                                    <CollectionView ItemsSource="{Binding Goals}">
                                        <CollectionView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid ColumnDefinitions="Auto, *, Auto" VerticalOptions="Center">

                                                    <CheckBox
                                                        Grid.Column="0"
                                                        IsChecked="{Binding IsCompleted}"
                                                        VerticalOptions="Center"
                                                        Color="Black" />

                                                    <Entry
                                                        Grid.Column="1"
                                                        FontSize="14"
                                                        Placeholder="Zielbeschreibung"
                                                        Text="{Binding Description}" />


                                                    <Label
                                                        Grid.Column="2"
                                                        Padding="8,0,0,0"
                                                        FontSize="20"
                                                        HorizontalOptions="End"
                                                        Text="↕"
                                                        VerticalOptions="Center">
                                                        <Label.GestureRecognizers>
                                                            <DragGestureRecognizer DragStartingCommand="{Binding BindingContext.StartGoalDragCommand, Source={x:Reference MainPageRef}}" DragStartingCommandParameter="{Binding}" />
                                                        </Label.GestureRecognizers>
                                                    </Label>

                                                </Grid>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>

                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <Frame
            Margin="10"
            Padding="10"
            AbsoluteLayout.LayoutBounds="0,1,1,90"
            AbsoluteLayout.LayoutFlags="WidthProportional,PositionProportional"
            BackgroundColor="{StaticResource BackgroundAddQuest}"
            BorderColor="{StaticResource BorderAddQuest}"
            CornerRadius="20"
            HasShadow="True"
            HorizontalOptions="Fill"
            VerticalOptions="End">

            <Grid ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  Sci-Fi Farben  -->
                <Button
                    Grid.Column="0"
                    BackgroundColor="{StaticResource Rainbow0}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="NeonRed"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="1"
                    BackgroundColor="{StaticResource Rainbow1}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="NeonOrange"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="2"
                    BackgroundColor="{StaticResource Rainbow2}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="NeonYellow"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="3"
                    BackgroundColor="{StaticResource Rainbow3}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="CyberGreen"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="4"
                    BackgroundColor="{StaticResource Rainbow4}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="ElectricBlue"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="5"
                    BackgroundColor="{StaticResource Rainbow5}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="Ultraviolet"
                    CornerRadius="12"
                    Text="+" />
                <Button
                    Grid.Column="6"
                    BackgroundColor="{StaticResource Rainbow6}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="SteelGray"
                    CornerRadius="12"
                    Text="+" />
            </Grid>
        </Frame>
    </Grid>


</ContentPage>
