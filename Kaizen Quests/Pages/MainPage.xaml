<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="Kaizen_Quests.Pages.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewModels="clr-namespace:Kaizen_Quests.ViewModels"
    x:Name="MainPageRef"
    BackgroundColor="{StaticResource BackgroundMain}"
    Shell.NavBarIsVisible="False">
    <ContentPage.BindingContext>
        <viewModels:MainViewModel />
    </ContentPage.BindingContext>
    <Grid RowDefinitions="*,Auto">
        <Frame
            Margin="12,12,12,0"
            Padding="0"
            BackgroundColor="{StaticResource BackgroundMain}"
            BorderColor="Transparent"
            CornerRadius="25">
            <!--  Quest-Liste  -->
            <CollectionView ItemsSource="{Binding Quests}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame
                            x:Name="QuestFrame"
                            Margin="0,0,0,12"
                            Padding="9"
                            BackgroundColor="{Binding Color}"
                            BorderColor="#88888888"
                            CornerRadius="20"
                            HasShadow="True">
                            <VerticalStackLayout>
                                <!--  Quest-Header mit Grid  -->
                                <Frame
                                    Padding="0"
                                    BackgroundColor="{StaticResource BackgroundAddGoal}"
                                    BorderColor="{StaticResource Gray200}"
                                    CornerRadius="24"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Center">
                                    <Label
                                        Padding="3"
                                        BackgroundColor="Transparent"
                                        FontAttributes="Bold"
                                        FontSize="16"
                                        HorizontalTextAlignment="Center"
                                        Text="{Binding Title}"
                                        TextColor="{StaticResource Gray600}"
                                        VerticalTextAlignment="Center">
                                        <Label.GestureRecognizers>
                                            <DragGestureRecognizer DragStartingCommand="{Binding BindingContext.StartQuestDragCommand, Source={x:Reference MainPageRef}}" DragStartingCommandParameter="{Binding}" />
                                            <DropGestureRecognizer DropCommand="{Binding BindingContext.QuestDropCommand, Source={x:Reference MainPageRef}}" DropCommandParameter="{Binding}" />
                                        </Label.GestureRecognizers>
                                    </Label>
                                </Frame>
                                <!--  Goals CollectionView  -->
                                <CollectionView ItemsSource="{Binding Goals}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid>
                                                <!--  Regular Goal  -->
                                                <Frame
                                                    Padding="0"
                                                    BackgroundColor="{StaticResource BackgroundAddGoal}"
                                                    BorderColor="{StaticResource Gray200}"
                                                    CornerRadius="24"
                                                    HorizontalOptions="Fill"
                                                    VerticalOptions="Center"
                                                    IsVisible="{Binding IsRegularGoal}">
                                                    <HorizontalStackLayout>
                                                        <CheckBox
                                                            Grid.Column="0"
                                                            Margin="6"
                                                            HeightRequest="20"
                                                            IsChecked="{Binding IsCompleted}"
                                                            VerticalOptions="Center"
                                                            WidthRequest="36"
                                                            Color="{StaticResource Gray500}" />
                                                        <Label
                                                            Grid.Column="1"
                                                            FontSize="14"
                                                            HorizontalOptions="Fill"
                                                            Text="{Binding Description}"
                                                            TextColor="{StaticResource Gray600}"
                                                            VerticalTextAlignment="Center">
                                                            <Label.GestureRecognizers>
                                                                <DragGestureRecognizer DragStartingCommand="{Binding BindingContext.StartGoalDragCommand, Source={x:Reference MainPageRef}}" DragStartingCommandParameter="{Binding}" />
                                                                <DropGestureRecognizer DropCommand="{Binding BindingContext.GoalDropCommand, Source={x:Reference MainPageRef}}" DropCommandParameter="{Binding}" />
                                                            </Label.GestureRecognizers>
                                                        </Label>
                                                    </HorizontalStackLayout>
                                                </Frame>
                                                <!--  AddGoal Goal  -->
                                                <Frame
                                                    Margin="0"
                                                    Padding="0"
                                                    BackgroundColor="{StaticResource BackgroundAddGoal}"
                                                    BorderColor="{StaticResource Gray200}"
                                                    CornerRadius="24"
                                                    HorizontalOptions="Fill"
                                                    IsVisible="{Binding IsAddGoal}"
                                                    VerticalOptions="Center">
                                                    <Frame.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding BindingContext.AddGoalCommand, Source={x:Reference MainPageRef}}" CommandParameter="{Binding BindingContext, Source={x:Reference QuestFrame}}" />
                                                    </Frame.GestureRecognizers>
                                                    <Label
                                                        FontSize="14"
                                                        HorizontalOptions="Center"
                                                        Text="+"
                                                        TextColor="Gray"
                                                        VerticalOptions="Center"
                                                        VerticalTextAlignment="Center" />
                                                </Frame>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Frame>
        <Frame
            Grid.Row="1"
            Margin="10"
            Padding="10"
            AbsoluteLayout.LayoutBounds="0,1,1,90"
            AbsoluteLayout.LayoutFlags="WidthProportional,PositionProportional"
            BackgroundColor="{StaticResource BackgroundAddQuest}"
            BorderColor="{StaticResource BorderAddQuest}"
            CornerRadius="20"
            HasShadow="True"
            HorizontalOptions="Fill"
            VerticalOptions="End">
            <Grid ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  Sci-Fi Farben  -->
                <Button
                    Grid.Column="0"
                    BackgroundColor="{StaticResource Rainbow0}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="0"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="1"
                    BackgroundColor="{StaticResource Rainbow1}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="1"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="2"
                    BackgroundColor="{StaticResource Rainbow2}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="2"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="3"
                    BackgroundColor="{StaticResource Rainbow3}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="3"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="4"
                    BackgroundColor="{StaticResource Rainbow4}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="4"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="5"
                    BackgroundColor="{StaticResource Rainbow5}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="5"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
                <Button
                    Grid.Column="6"
                    BackgroundColor="{StaticResource Rainbow6}"
                    BorderColor="{StaticResource BorderAddQuest}"
                    Command="{Binding AddQuestCommand}"
                    CommandParameter="6"
                    CornerRadius="12"
                    FontSize="14"
                    Text="+"
                    TextColor="Gray" />
            </Grid>
        </Frame>
    </Grid>
</ContentPage>
